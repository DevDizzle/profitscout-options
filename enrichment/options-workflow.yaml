main:
  steps:
    - init:
        assign:
          - project_id: "profitscout-lx6bb"
          - region: "us-central1"
          - options_fetcher_name: "options-fetcher"
          - options_feature_engineering_name: "run-options-feature-engineering"
          - options_selector_name: "options-selector"
          - options_analyzer_name: "options-analyzer"
          - sync_options_to_firestore_name: "run-sync-options-to-firestore"

    - call_options_fetcher:
        call: http.post
        args:
          url: ${"https://" + region + "-" + project_id + ".cloudfunctions.net/" + options_fetcher_name}
          auth: { type: OIDC }
          timeout: 1800 # 30 minutes
        result: options_fetcher_result

    - call_options_feature_engineering:
        call: http.post
        args:
          url: ${"https://" + region + "-" + project_id + ".cloudfunctions.net/" + options_feature_engineering_name}
          auth: { type: OIDC }
          timeout: 1800 # 30 minutes
        result: options_feature_engineering_result

    - call_options_selector:
        call: http.post
        args:
          url: ${"https://" + region + "-" + project_id + ".cloudfunctions.net/" + options_selector_name}
          auth: { type: OIDC }
          timeout: 900 # 15 minutes
        result: options_selector_result

    - call_options_analyzer:
        call: http.post
        args:
          url: ${"https://" + region + "-" + project_id + ".cloudfunctions.net/" + options_analyzer_name}
          auth: { type: OIDC }
          timeout: 1800 # 30 minutes
        result: options_analyzer_result

    - call_sync_options_to_firestore:
        call: http.post
        args:
          url: ${"https://" + region + "-" + project_id + ".cloudfunctions.net/" + sync_options_to_firestore_name}
          auth: { type: OIDC }
          timeout: 900 # 15 minutes
          body:
            full_reset: false
        result: sync_options_result

    - log_finish:
        call: sys.log
        args:
          text: "Options workflow finished successfully."

    - done:
        return: "Workflow finished successfully."